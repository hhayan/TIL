# chatbot 만들기 with telegram

네, 텔레그램 챗봇 수업 내용을 이해하기 쉽게 정리해 드릴게요. 제공해주신 코드를 바탕으로 설명하겠습니다.

-----
### 1\. 주민등록번호

**봇 토큰**은 텔레그램 봇의 **주민등록번호**라고 생각하면 돼요. 이 토큰이 있어야 텔레그램 시스템이 "아, 이 요청은 이 봇에게 하는 거구나\!" 하고 알아챌 수 있습니다. 수업 코드에서는 `bot_token`이라는 변수에 이 값이 저장되어 있었죠.

```python
bot_token = '8094231169:AAGEmcVeMvUSbhpbHmJPT0dgKx7NjstQtQ8'
```

**참고:** 이 토큰은 외부에 노출되지 않도록 주의해야 해요\! 마치 내 주민등록번호처럼 소중하니까요.

### 2\. 기본 URL (Base URL)

텔레그램 봇과 소통하려면 특정 주소로 요청을 보내야 해요. 이 주소는 봇 토큰을 포함한 **기본 URL**로 시작합니다.

```python
URL = f'https://api.telegram.org/bot{bot_token}'
```

이 `URL` 뒤에 어떤 요청을 할지 덧붙여서 다양한 작업을 수행할 수 있습니다.

### 3\. 텔레그램 API 주요 기능 (URL 뒤에 붙는 친구들)

우리가 텔레그램 봇에게 무엇을 시킬지는 기본 URL 뒤에 특정 명령어를 붙여서 알려줍니다. 수업에서 다룬 주요 기능들은 다음과 같습니다.

  * `/getMe`: **봇 정보 가져오기**

      * `URL + '/getMe'` 라고 요청하면, 내가 만든 봇의 이름이나 아이디 같은 기본 정보를 확인할 수 있어요.

  * `/getUpdates`: **새로운 메시지 확인하기**

      * `URL + '/getUpdates'` 라고 요청하면, 봇에게 도착한 **새로운 메시지들**을 모두 가져올 수 있어요. 마치 봇에게 온 편지들을 한 번에 확인하는 것과 같아요. 코드를 보면 `requests.get(URL + '/getUpdates').json()`으로 메시지들을 JSON 형태로 가져와서 `data` 변수에 저장했죠.

  * `/sendMessage`: **메시지 보내기**

      * `URL + '/sendMessage'` 라고 요청하면, 봇이 사용자에게 **답장을 보낼 수 있어요.** 메시지를 보낼 때는 `chat_id` (누구에게 보낼지)와 `text` (무슨 내용을 보낼지)를 함께 알려줘야 합니다.

### 4\. 봇의 동작 원리 (메시지 받고, 처리하고, 응답하기)

수업에서 가장 중요하게 다룬 부분은 봇이 메시지를 받고 처리해서 응답하는 과정일 거예요.

1.  **메시지 받기:**

      * `data = requests.get(URL + '/getUpdates').json()` 코드를 통해 봇에게 온 **최신 메시지 정보**를 `data` 변수에 저장했어요.
      * `input_msg = data["result"][-1]["message"]["text"]` 이 코드는 `data` 안에서 **가장 마지막으로 온 메시지의 내용**(`text`)을 `input_msg` 변수에 담는 역할을 합니다.
      * `sender_id = data["result"][-1]["message"]["from"]['id']` 이 코드는 메시지를 보낸 **사용자의 ID**를 `sender_id` 변수에 저장해요. 이 ID가 있어야 나중에 답장을 보낼 수 있겠죠?

2.  **메시지 처리 및 응답 내용 결정:**

      * `if input_msg in ('로또', 'lotto', '가즈아'):` 와 같이 `if/elif/else` 문을 사용해서 사용자가 보낸 메시지(`input_msg`)에 따라 봇이 어떤 응답(`output_msg`)을 할지 결정합니다.
      * 예를 들어, "로또"라고 보내면 랜덤으로 6개의 로또 번호를 생성해서 응답하고, "안녕"이라고 보내면 "오냐"라고 응답하는 식이죠. 그 외의 메시지에는 "아직은 그런건 몰루"라고 대답하게 되어 있습니다.

3.  **응답 보내기:**

      * 봇이 사용자에게 보낼 메시지(`output_msg`)가 결정되면, `body`라는 딕셔너리에 `chat_id` (누구에게)와 `text` (무엇을) 정보를 담습니다.
      * 마지막으로 `requests.get(URL + '/sendMessage', body)` 코드를 실행해서 텔레그램 API에 이 `body` 내용을 보내고, 봇이 사용자에게 답장 메시지를 전송하게 됩니다.

-----

### 마치며

텔레그램 챗봇은 이렇게 메시지를 **받고** (getUpdates), **내용을 분석해서 처리하고**, **응답 메시지를 보내는** (sendMessage) 과정의 반복이라고 할 수 있습니다. 오늘 배운 내용을 바탕으로 자신만의 재미있는 봇을 만들어 보세요\! 혹시 더 궁금한 점이 있으시면 언제든지 다시 질문해주세요.

-------------------------------------------------------------------------------------------
main파일 요약

네, 오늘 배우신 `main.py` 코드를 이해하기 쉽게 설명해 드릴게요. 이 코드는 **FastAPI**라는 웹 프레임워크를 사용해서 간단한 웹 서버를 만들고, 텔레그램 봇과 연동하는 방법을 보여주고 있어요.
-----

### FastAPI와 웹 API 기본 이해하기

일단 가장 먼저 이해해야 할 건 **FastAPI**와 **웹 API**입니다.

  * 웹프레임워크? 웹 애플리케이션 개발을 위한 도구들의 집합
  * **FastAPI**: 파이썬으로 웹 서버를 쉽게 만들 수 있게 도와주는 도구예요. 우리가 평소에 사용하는 웹사이트나 앱이 작동하려면 뒤에서 정보를 주고받는 서버가 필요한데, FastAPI가 바로 이 서버를 만드는 데 특화되어 있죠.
  * **웹 API (Application Programming Interface)**: 특정 기능을 수행하도록 만들어진 웹 주소라고 생각하면 쉬워요. 우리가 인터넷 주소창에 `naver.com`을 입력하면 네이버 홈페이지가 뜨는 것처럼, API 주소에 접속하면 특정 작업을 수행하거나 정보를 돌려줍니다.

  웹 API 프레임워크는 웹 애플리케이션(레스토랑)에서 웹 API(주방)를 효율적으로 운영하기 위한 도구와 규칙을 제공하는 것

### `main.py` 코드 한 줄씩 살펴보기

이제 코드를 차례대로 볼게요.

```python
'''
터미널에서 아래 두줄 터미널에서 설치 해야함
pip install fastapi
pip install uvicorn[standard]

이후 아래 터미널 명령어로 서버 켬
uvicorn main:app --reload
'''
```

-----

#### 1\. 시작 준비: 필요한 패키지 설치 및 서버 실행

이 주석은 이 코드를 실행하기 위한 준비물과 방법을 알려줍니다.

  * **`pip install fastapi`**: FastAPI라는 웹 프레임워크를 설치하는 명령어예요. FastAPI를 이용해서 웹 서버를 만들려면 이게 꼭 필요합니다.
  * **`pip install uvicorn[standard]`**: **Uvicorn**은 FastAPI로 만든 웹 서버를 실제로 실행시켜주는 역할을 해요. 마치 웹사이트를 보여주는 '웹 브라우저' 같은 역할을 서버 쪽에서 한다고 생각하면 됩니다.
  * **`uvicorn main:app --reload`**: 서버를 실행하는 명령어입니다.
      * `main`: `main.py` 파일 이름이에요.
      * `app`: 파일 안에서 `FastAPI()`로 만든 객체 이름이에요.
      * `--reload`: 코드를 수정하면 서버를 자동으로 다시 시작해줘서 개발할 때 아주 편리해요.

<!-- end list -->

```python
from fastapi import FastAPI
import random
import requests

app = FastAPI()
```

-----

#### 2\. 필요한 라이브러리 가져오기 (`import`)

  * `from fastapi import FastAPI`: FastAPI의 핵심 기능을 가져옵니다.
  * `import random`: 무작위 숫자를 뽑을 때 사용하는 라이브러리예요. 로또 번호 생성에 쓰입니다.
  * `import requests`: 다른 웹사이트나 API에 요청을 보낼 때 사용하는 라이브러리예요. 여기서는 텔레그램 API에 메시지를 보낼 때 사용됩니다.
  * `app = FastAPI()`: FastAPI 앱 객체를 `app`이라는 이름으로 만듭니다. 이 `app` 객체가 우리가 만들 웹 서버의 중심이 됩니다.

<!-- end list -->

```python
@app.get('/hi')
def hi():
    return {'status': '굿'}
```

-----

#### 3\. 첫 번째 API: `/hi`

  * **`@app.get('/hi')`**: 이 부분은 **데코레이터**라고 부르는데, `app.get`은 "이 아래에 있는 함수는 `/hi`라는 주소로 **GET 방식** 요청이 들어왔을 때 실행해라"는 의미예요. 웹 브라우저에서 특정 주소로 접속하는 것이 기본적으로 GET 요청입니다.
  * **`def hi():`**: `/hi` 주소로 요청이 오면 실행될 함수입니다.
  * **`return {'status': '굿'}`**: 이 함수가 실행되면 웹 브라우저에 `{'status': '굿'}`이라는 JSON 형태의 데이터를 돌려줍니다. 웹 브라우저 주소창에 `http://127.0.0.1:8000/hi` (서버가 실행 중일 때)라고 입력하면 이 메시지를 볼 수 있을 거예요.

<!-- end list -->

```python
@app.get('/lotto')
def lotto():
    numbers = random.sample(range(1, 46), 6)
    return {
        'numbers': numbers
    }
```

-----

#### 4\. 두 번째 API: `/lotto`

  * **`@app.get('/lotto')`**: `/lotto` 주소로 GET 요청이 오면 실행됩니다.
  * **`numbers = random.sample(range(1, 46), 6)`**: 1부터 45까지의 숫자 중 6개를 무작위로 뽑아 `numbers` 변수에 저장해요.
  * **`return {'numbers': numbers}`**: 뽑힌 로또 번호들을 JSON 형태로 돌려줍니다. `http://127.00.0.1:8000/lotto` 에 접속하면 매번 새로운 로또 번호 6개를 볼 수 있습니다.

<!-- end list -->

```python
@app.get('/gogogo')
def gogogo():
    bot_token = '8094231169:AAGEmcVeMvUSbhpbHmJPT0dgKx7NjstQtQ8'
    URL = f'https://api.telegram.org/bot{bot_token}'
    body = {
        'chat_id': '765946187',
        'text': '이 메시지는 서버가 보냄',
    }
    requests.get(URL + '/sendMessage', body)
    return {'status': 'gogogo'}
```

-----

#### 5\. 세 번째 API: `/gogogo` (텔레그램 메시지 보내기)

이 부분이 어제 배우신 텔레그램 봇과 연동되는 핵심 부분입니다.

  * **`@app.get('/gogogo')`**: `/gogogo` 주소로 GET 요청이 오면 실행됩니다.
  * **`bot_token = '...'`**: 텔레그램 봇의 주민등록번호인 봇 토큰입니다.
  * **`URL = f'https://api.telegram.org/bot{bot_token}'`**: 텔레그램 API의 기본 주소를 만듭니다.
  * **`body = {'chat_id': '765946187', 'text': '이 메시지는 서버가 보냄'}`**: 텔레그램으로 보낼 메시지의 내용을 준비합니다.
      * `chat_id`: 메시지를 받을 사람(또는 그룹)의 ID예요. `765946187`은 특정 사용자 ID를 가리키겠죠?
      * `text`: 실제 보낼 메시지 내용입니다.
  * **`requests.get(URL + '/sendMessage', body)`**: 텔레그램 API의 `/sendMessage` 주소로 `body`에 담긴 메시지 내용을 보내는 요청을 보냅니다. 이 줄이 실행되면 **해당 `chat_id`를 가진 사용자에게 "이 메시지는 서버가 보냄"이라는 텔레그램 메시지가 전달돼요.**
  * **`return {'status': 'gogogo'}`**: 이 API가 성공적으로 실행되었음을 알리는 메시지를 웹 브라우저에 돌려줍니다.

### 요약하면:

이 `main.py` 파일은 다음과 같은 기능을 하는 작은 웹 서버를 만듭니다.

  * **`/hi` 주소로 접속하면 "굿"이라는 상태 메시지를 보여줍니다.**
  * **`/lotto` 주소로 접속하면 매번 새로운 로또 번호 6개를 생성해서 보여줍니다.**
  * **`/gogogo` 주소로 접속하면 특정 텔레그램 사용자에게 "이 메시지는 서버가 보냄"이라는 메시지를 보내고, 서버에서는 "gogogo" 상태 메시지를 보여줍니다.**

즉, 서버를 켜놓고 `/gogogo` 주소로 웹 요청을 보내면, 우리가 어제 배운 텔레그램 봇이 메시지를 보내는 작업을 **자동으로** 수행하게 만드는 것이죠. 웹 요청을 통해 텔레그램 봇을 제어하는 예시라고 볼 수 있습니다.

* 총정리: 
---

## 오늘 배운 내용 핵심 요약

오늘 수업에서는 **FastAPI를 이용한 웹 서버 구축**과 **텔레그램 봇 연동**의 두 가지 핵심 내용을 배우셨습니다.

1.  **FastAPI 웹 서버**:
    * **FastAPI**는 파이썬으로 **웹 API(특정 기능 수행 웹 주소)**를 쉽게 만들게 해주는 도구입니다.
    * `@app.get('/경로')`를 사용하여 특정 웹 주소(`경로`)로 접속했을 때 실행될 함수를 정의할 수 있습니다. 예를 들어, `/lotto`에 접속하면 로또 번호를 반환하고, `/gogogo`에 접속하면 텔레그램 메시지를 보냅니다.
    * **Uvicorn**으로 `uvicorn main:app --reload` 명령어를 통해 FastAPI 서버를 실행합니다.

2.  **텔레그램 봇 연동**:
    * **봇 토큰**은 텔레그램 봇의 고유 식별자입니다.
    * `requests` 라이브러리를 사용하여 텔레그램 API에 요청을 보냅니다.
    * `https://api.telegram.org/bot{봇_토큰}/sendMessage` 주소로 `chat_id`(메시지 받을 사람)와 `text`(메시지 내용)를 함께 보내면 텔레그램 메시지를 전송할 수 있습니다.

결론적으로, 웹 서버를 통해 특정 주소에 접속하는 것만으로 텔레그램 봇이 자동으로 메시지를 보내도록 제어하는 방법을 배우신 것입니다.

7/25
tip: git terminal 안되면 오른쪽에서 휴지통 버튼 누르기!

코드가 바뀌어도 ctrl + S: 자동으로 변경내용 반영해서 서버에 반영해줌 

[telegram_chatbot 만들기]
bot 주민번호

bot정보받기: getme
정보 업데이트: getupdates
메세지 보내기: sendMessage

답장 보내기: 목적지, 내용
id, message

봇 업데이트 받아서, 마지막 메세지 & 유저 받아오기

오류메세지: 400번 클라이언트 잘못, 500번 서버 잘못

7/25
답장하기: 우리 서버 -> 내가 만든 봇 telegram

bot_token?

# API는 돈 주고 산거니까 git에 오픈되면 안됨! 큰일나 돈 엄청 내야함!
.gitignore이라는 파일을 만들기
.gitignore 파일 내부에 .env라고 파일명을 적었음 Git은 해당 .env 파일을 추적하지 않게 됩니다.
즉, Git 저장소에 .env 파일이 커밋되거나 변경 사항으로 감지되지 않습니다.

질문) 파일명이 .env여야만 하는가? 아니요, 꼭 .env 파일이어야 하는 것은 아닙니다.
하지만 대부분의 경우 .env를 사용하는 것이 강력히 권장되는 표준적인 관행입니다.
라이브러리/프레임워크의 기본 동작: python-dotenv와 같은 dotenv 관련 라이브러리들은 기본적으로 프로젝트 루트 디렉토리에서 .env라는 이름의 파일을 찾도록 설계되어 있습니다. 다른 이름으로 파일을 만들면, 해당 라이브러리를 사용할 때 파일 경로를 명시적으로 지정해 주어야 합니다.

지정된 것만 무시: .gitignore 파일에 작성된 규칙(패턴)에 일치하는 파일이나 디렉토리만 Git이 무시합니다.

이미 추적 중인 파일: 만약 어떤 파일이 .gitignore에 추가되기 전에 이미 Git에 의해 추적되고(커밋되고) 있었다면, .gitignore에 해당 파일이 추가되더라도 Git은 그 파일을 계속 추적합니다. 이 경우, 해당 파일을 Git 추적에서 완전히 제외하려면 git rm --cached <파일이름> 명령어를 사용하여 Git 인덱스에서 파일을 제거한 후 다시 커밋해야 합니다.

폴더 전체 무시: 폴더 이름 뒤에 슬래시(/)를 붙여서 .gitignore에 추가하면 해당 폴더 전체가 무시됩니다. 예: my_folder/

특정 파일 형식 무시: 특정 확장자나 파일 이름 패턴을 무시할 수 있습니다. 예: *.log, temp_files/




